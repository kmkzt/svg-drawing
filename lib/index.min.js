!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("two.js")):"function"==typeof define&&define.amd?define(["exports","two.js"],e):e((t=t||self)["svg-drawing"]={},t.Two)}(this,(function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}var r=function(t){var e="string"==typeof t?(new DOMParser).parseFromString(t,"image/svg+xml"):t,n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=e.querySelector("svg");return i?(["width","height","viewBox"].map((function(t){var e=i.getAttribute(t);e&&n.setAttribute(t,e)})),e.querySelectorAll("path").forEach((function(t){t.removeAttribute("transform"),n.appendChild(t)})),n):n},s=function(t){void 0===t&&(t=!0);try{var e=function(){return null};return window.addEventListener("testPassive",e,{passive:t}),window.removeEventListener("testPassive",e),{passive:t}}catch(t){return!1}},a=function(t){function n(n){var i=t.call(this,n)||this;return i.clearListner=i.clearListner.bind(i),i.toSvgXml=i.toSvgXml.bind(i),i.toSvgBase64=i.toSvgBase64.bind(i),i.drawingStart=i.drawingStart.bind(i),i.drawingMove=i.drawingMove.bind(i),i.drawingEnd=i.drawingEnd.bind(i),i.mouseUp=i.mouseUp.bind(i),i.mouseMove=i.mouseMove.bind(i),i.mouseDown=i.mouseDown.bind(i),i.touchStart=i.touchStart.bind(i),i.touchMove=i.touchMove.bind(i),i.touchEnd=i.touchEnd.bind(i),i.init.bind(i),i.line=null,i.current=new e.Vector(0,0),i.penColor=n.penColor||"#333",i.penWidth=n.penWidth||10,i.strokeCap=n.strokeCap||"round",i.strokeLineJoin=n.strokeLineJoin||"round",i.type=n.type||e.Types.svg,i.el=n.el,i.width=n.width||i.el.clientWidth,i.height=n.height||i.el.clientHeight,i.init(),i}return i(n,t),n.prototype.toSvgXml=function(){var t=this.renderer.domElement,e=r(t.outerHTML);return t?'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'" viewBox="0 0 '+this.width+" "+this.height+'">'+e.innerHTML+"</svg>":null},n.prototype.toSvgBase64=function(){var t=this.toSvgXml();return t?"data:image/svg+xml;base64,"+btoa(t):null},n.prototype.clearListner=function(){this.el.removeEventListener("mousedown",this.mouseDown),this.el.removeEventListener("touchstart",this.touchStart)},n.prototype.init=function(){return this.appendTo(this.el),this.el.addEventListener("mousedown",this.mouseDown,s(!1)),this.el.addEventListener("touchstart",this.touchStart,s(!1)),this},n.prototype.drawingStart=function(t){var e=t.x,n=t.y;this.current.set(e,n)},n.prototype.drawingMove=function(t){var n=this,i=t.x,o=t.y,r=this.el.getBoundingClientRect(),s=function(t,n){return new e.Vector(t-r.left,n-r.top)};if(this.line){if(this.line.linewidth!==this.penWidth||this.line.stroke!==this.penColor)return void this.drawingEnd();var a=s(i,o);this.line.vertices.push(a)}else{var h=s(this.current.x,this.current.y),u=s(i,o);this.current.set(i,o),this.line=this.makeCurve([h,u],!0),this.line.noFill().stroke=this.penColor,this.line.linewidth=this.penWidth,this.line.cap=this.strokeCap,this.line.join=this.strokeLineJoin,this.line.vertices.map((function(t){n.line&&t.addSelf(n.line.translation)})),this.line.translation.clear()}},n.prototype.drawingEnd=function(){this.line=null},n.prototype.mouseDown=function(t){t.preventDefault(),this.drawingStart({x:t.clientX,y:t.clientY}),this.el.addEventListener("mousemove",this.mouseMove,s(!1)),this.el.addEventListener("mouseup",this.mouseUp,s(!1))},n.prototype.mouseMove=function(t){t.preventDefault(),this.drawingMove({x:t.clientX,y:t.clientY})},n.prototype.mouseUp=function(t){t.preventDefault(),this.el.removeEventListener("mousemove",this.mouseMove),this.el.removeEventListener("mouseup",this.mouseUp),this.drawingEnd()},n.prototype.touchStart=function(t){t.preventDefault();var e=t.touches[0];this.drawingStart({x:e.clientX,y:e.clientY}),this.el.addEventListener("touchmove",this.touchMove,s(!1)),this.el.addEventListener("touchend",this.touchEnd,s(!1))},n.prototype.touchMove=function(t){t.preventDefault();var e=t.touches[0];this.drawingMove({x:e.clientX,y:e.clientY})},n.prototype.touchEnd=function(t){t.preventDefault(),this.el.removeEventListener("touchmove",this.touchMove),this.el.removeEventListener("touchend",this.touchEnd),this.drawingEnd()},n}(e),h=function(t){function n(n){var i=t.call(this,n)||this;return i.animationStart=i.animationStart.bind(i),i.shaking=i.shaking.bind(i),i.initSvgXml=i.initSvgXml.bind(i),i.strokeAnimation=i.strokeAnimation.bind(i),i.loadScene=i.loadScene.bind(i),i.loadSvgXml=i.loadSvgXml.bind(i),i.splitEnd=i.splitEnd.bind(i),i.shakingRange=n.shakingRange||2,i.type=n.type||e.Types.canvas,i.el=n.el,i.width=n.width||i.el.clientWidth,i.height=n.height||i.el.clientHeight,i.animationStart(),i}return i(n,t),n.prototype.shaking=function(){var t=this,e=function(){return Math.random()*t.shakingRange-t.shakingRange/2},n=function(n,i){n%5==0&&t.scene.children.map((function(t){t.vertices&&t.vertices.map((function(t){t.position||(t.position=t.clone()),t.x=t.position.x+e(),t.y=t.position.y+e()}))}))};return this.bind("update",n).play(),function(){t.unbind("update",n),t.scene.children.map((function(t){var e=t.vertices;e&&e.map((function(t){t.position&&(t.x=t.position.x,t.y=t.position.y,delete t.position)}))}))}},n.prototype.loadScene=function(t){var e=this;this.clear(),t.children.map((function(t){e.scene.add(t.clone())})),this.update()},n.prototype.loadSvgXml=function(t){var e=this,n=r(t);if(n){var i=this.interpret(n);this.clear(),document.body.appendChild(n);var o=n.clientWidth;document.body.removeChild(n),this.scene.scale=this.width/o,i.children.map((function(t){e.scene.add(t.clone())})),this.scene.center().translation.set(this.width/2,this.height/2),this.update()}},n.prototype.animationStart=function(){return this.appendTo(this.el),this},n.prototype.initSvgXml=function(t){this.clear();var e=this.interpret(t);e.subdivide(),this.scene.add(e)},n.prototype.strokeAnimation=function(){var t=this,e=0,n=function(){e<.9999?e+=.00625:e=0,u(t.scene,e)};return this.bind("update",n).play(),function(){return t.unbind("update",n)}},n.prototype.splitEnd=function(t){u(this.scene,t),this.update()},n}(e),u=function(t,e){for(var n=function(t){return t.children.reduce((function(t,e){var n,i=0;return e.vertices?(e.vertices.map((function(t,e){e>0&&(i+=n.distanceTo(t)),n=t})),function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}(t,[i])):t}),[])}(t),i=e*n.reduce((function(t,e){return t+e}),0),r=0,s=0;s<t.children.length;s++){var a=r,h=r+n[s];t.children[s].ending=c(i,a,h,0,1),r=h}};var c=function(t,e,n,i,o){return function(t,e,n){return Math.max(Math.min(t,n),e)}(function(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}(t,e,n,i,o),i,o)};t.SvgAnimation=h,t.SvgDrawing=a,Object.defineProperty(t,"__esModule",{value:!0})}));
