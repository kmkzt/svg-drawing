!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("two.js")):"function"==typeof define&&define.amd?define(["exports","two.js"],e):e((t=t||self)["svg-drawing"]={},t.Two)}(this,(function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const i=t=>{const e="string"==typeof t?(new DOMParser).parseFromString(t,"image/svg+xml"):t,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=e.querySelector("svg");return s?(["width","height","viewBox"].map(t=>{const e=s.getAttribute(t);e&&i.setAttribute(t,e)}),e.querySelectorAll("path").forEach(t=>{t.removeAttribute("transform"),i.appendChild(t)}),i):i},s=(t=!0)=>{try{const e=()=>null;return window.addEventListener("testPassive",e,{passive:t}),window.removeEventListener("testPassive",e),{passive:t}}catch(t){return!1}};const n=(t,e)=>{const i=function(t){return t.children.reduce((t,e)=>{let i,s=0;return e.vertices?(e.vertices.map((t,e)=>{e>0&&(s+=i.distanceTo(t)),i=t}),[...t,s]):t},[])}(t),s=e*i.reduce((t,e)=>t+e,0);let n=0;for(let e=0;e<t.children.length;e++){const o=n,r=n+i[e];t.children[e].ending=h(s,o,r,0,1),n=r}};const h=(t,e,i,s,n)=>((t,e,i)=>Math.max(Math.min(t,i),e))(((t,e,i,s,n)=>s+(t-e)/(i-e)*(n-s))(t,e,i,s,n),s,n);t.SvgAnimation=class extends e{constructor(t){super(t),this.animationStart=this.animationStart.bind(this),this.shaking=this.shaking.bind(this),this.initSvgXml=this.initSvgXml.bind(this),this.strokeAnimation=this.strokeAnimation.bind(this),this.loadScene=this.loadScene.bind(this),this.loadSvgXml=this.loadSvgXml.bind(this),this.splitEnd=this.splitEnd.bind(this),this.shakingRange=t.shakingRange||2,this.type=t.type||e.Types.canvas,this.el=t.el,this.width=t.width||this.el.clientWidth,this.height=t.height||this.el.clientHeight,this.animationStart()}shaking(){const t=()=>Math.random()*this.shakingRange-this.shakingRange/2,e=(e,i)=>{e%5==0&&this.scene.children.map(e=>{e.vertices&&e.vertices.map(e=>{e.position||(e.position=e.clone()),e.x=e.position.x+t(),e.y=e.position.y+t()})})},i=()=>this.scene.children.map(t=>{const e=t.vertices;e&&e.map(t=>{t.position&&(t.x=t.position.x,t.y=t.position.y,delete t.position)})});return this.bind("update",e).play(),()=>{this.unbind("update",e),i()}}loadScene(t){this.clear(),t.children.map(t=>{this.scene.add(t.clone())}),this.update()}loadSvgXml(t){const e=i(t);if(!e)return;const s=this.interpret(e);this.clear(),document.body.appendChild(e);const n=e.clientWidth;document.body.removeChild(e),this.scene.scale=this.width/n,s.children.map(t=>{this.scene.add(t.clone())}),this.scene.center().translation.set(this.width/2,this.height/2),this.update()}animationStart(){return this.appendTo(this.el),this}initSvgXml(t){this.clear();const e=this.interpret(t);e.subdivide(),this.scene.add(e)}strokeAnimation(){let t=0;const e=()=>{t<.9999?t+=.00625:t=0,n(this.scene,t)};return this.bind("update",e).play(),()=>this.unbind("update",e)}splitEnd(t){n(this.scene,t),this.update()}},t.SvgDrawing=class extends e{constructor(t){super(t),this.clearListner=this.clearListner.bind(this),this.toSvgXml=this.toSvgXml.bind(this),this.toSvgBase64=this.toSvgBase64.bind(this),this.drawingStart=this.drawingStart.bind(this),this.drawingMove=this.drawingMove.bind(this),this.drawingEnd=this.drawingEnd.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseMove=this.mouseMove.bind(this),this.mouseDown=this.mouseDown.bind(this),this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.init.bind(this),this.line=null,this.current=new e.Vector(0,0),this.penColor=t.penColor||"#333",this.penWidth=t.penWidth||10,this.strokeCap=t.strokeCap||"round",this.strokeLineJoin=t.strokeLineJoin||"round",this.type=t.type||e.Types.svg,this.el=t.el,this.width=t.width||this.el.clientWidth,this.height=t.height||this.el.clientHeight,this.init()}toSvgXml(){const t=this.renderer.domElement,e=i(t.outerHTML);return t?'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+'" viewBox="0 0 '+this.width+" "+this.height+'">'+e.innerHTML+"</svg>":null}toSvgBase64(){const t=this.toSvgXml();return t?"data:image/svg+xml;base64,"+btoa(t):null}clearListner(){this.el.removeEventListener("mousedown",this.mouseDown),this.el.removeEventListener("touchstart",this.touchStart)}init(){return this.appendTo(this.el),this.el.addEventListener("mousedown",this.mouseDown,s(!1)),this.el.addEventListener("touchstart",this.touchStart,s(!1)),this}drawingStart({x:t,y:e}){this.current.set(t,e)}drawingMove({x:t,y:i}){const s=this.el.getBoundingClientRect(),n=(t,i)=>new e.Vector(t-s.left,i-s.top);if(this.line){if(this.line.linewidth!==this.penWidth||this.line.stroke!==this.penColor)return void this.drawingEnd();const e=n(t,i);return void this.line.vertices.push(e)}const h=n(this.current.x,this.current.y),o=n(t,i);this.current.set(t,i),this.line=this.makeCurve([h,o],!0),this.line.noFill().stroke=this.penColor,this.line.linewidth=this.penWidth,this.line.cap=this.strokeCap,this.line.join=this.strokeLineJoin,this.line.vertices.map(t=>{this.line&&t.addSelf(this.line.translation)}),this.line.translation.clear()}drawingEnd(){this.line=null}mouseDown(t){t.preventDefault(),this.drawingStart({x:t.clientX,y:t.clientY}),this.el.addEventListener("mousemove",this.mouseMove,s(!1)),this.el.addEventListener("mouseup",this.mouseUp,s(!1))}mouseMove(t){t.preventDefault(),this.drawingMove({x:t.clientX,y:t.clientY})}mouseUp(t){t.preventDefault(),this.el.removeEventListener("mousemove",this.mouseMove),this.el.removeEventListener("mouseup",this.mouseUp),this.drawingEnd()}touchStart(t){t.preventDefault();const e=t.touches[0];this.drawingStart({x:e.clientX,y:e.clientY}),this.el.addEventListener("touchmove",this.touchMove,s(!1)),this.el.addEventListener("touchend",this.touchEnd,s(!1))}touchMove(t){t.preventDefault();const e=t.touches[0];this.drawingMove({x:e.clientX,y:e.clientY})}touchEnd(t){t.preventDefault(),this.el.removeEventListener("touchmove",this.touchMove),this.el.removeEventListener("touchend",this.touchEnd),this.drawingEnd()}},Object.defineProperty(t,"__esModule",{value:!0})}));
