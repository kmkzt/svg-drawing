(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3554:function(t,e,n){"use strict";var i,s=n(7328),r=n(1628),a=n(7729),o=n.n(a),h=n(9097),l=n.n(h),c=n(2784),u=n(6451),d=n(8694),p=n(2322),v=(0,d.createGlobalStyle)(i||(i=(0,s.Z)(["\n body, * {\n   margin: 0;\n   box-sizing: border-box;\n }\n\n  a {\n    color: initial;\n    text-decoration: initial;\n  }\n"]))),g=function(){return(0,p.jsx)(u.xu,{bg:"#fafafa",py:"8px",px:"16px",children:(0,p.jsxs)(u.kC,{justifyContent:"space-between",children:[(0,p.jsx)(u.xu,{width:.3,children:(0,p.jsx)(l(),{href:"/",children:(0,p.jsx)("a",{children:(0,p.jsx)(u.xv,{fontSize:3,as:"h1",style:{whiteSpace:"nowrap"},children:"svg-drawing"})})})}),(0,p.jsxs)(u.kC,{as:"nav",alignContent:"center",width:.6,children:[(0,p.jsx)(l(),{href:"/",children:(0,p.jsx)("a",{children:(0,p.jsx)(u.xv,{mr:2,children:"drawing"})})}),(0,p.jsx)(u.xv,{mr:2,children:(0,p.jsx)(l(),{href:"/demo/animation",children:(0,p.jsx)("a",{children:"animation"})})}),(0,p.jsx)(u.xv,{mr:2,children:(0,p.jsx)(l(),{href:"/demo/img-trace",children:(0,p.jsx)("a",{children:"img-trace"})})})]}),(0,p.jsx)(u.xu,{width:.1,style:{textAlign:"right"},children:(0,p.jsx)(u.rU,{color:"#000",href:"https://github.com/kmkzt/svg-drawing",children:(0,p.jsx)(r.X,{size:"24"})})})]})})};e.Z=function(t){var e=t.children,n=t.title,i=void 0===n?"":n;return(0,p.jsxs)(c.Fragment,{children:[(0,p.jsx)(o(),{children:(0,p.jsx)("title",{children:"svg-drawing ".concat(i)})}),(0,p.jsx)(v,{}),(0,p.jsx)(g,{}),(0,p.jsx)(u.xu,{py:"12px",px:["2vw","2vw","5vw"],children:e})]})}},5228:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return d}});var i=n(8529),s=n(2146),r=n(2784);var a=n(6451),o=n(3554),h=n(2322),l=["none","#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#ddd","#9E9E9E","#444","black"],c=function(){return"#".concat(Array.from({length:3},(function(){return String((t=255,Math.floor(Math.random()*Math.floor(t))).toString(16)).padStart(2,"0");var t})).join(""))},u=function(t){var e=t.isSp,n=(0,r.useState)(!1),u=n[0],d=n[1],p=(0,r.useState)(!0),v=p[0],g=p[1],m=(0,r.useState)(!1),w=m[0],f=m[1],x=(0,r.useState)("none"),b=x[0],C=x[1],_=(0,r.useState)("black"),y=_[0],E=_[1],k=(0,r.useState)(20),j=k[0],S=k[1],L=(0,r.useState)(5),P=L[0],R=L[1],A=(t=>{const e=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useCallback)((()=>n.current?(0,s.en)(n.current.svg.toJson()).outerHTML:null),[]),a=(0,r.useCallback)((t=>{n.current&&n.current.download(t)}),[]),o=(0,r.useCallback)((t=>{n.current&&t&&(n.current.penColor=t)}),[]),h=(0,r.useCallback)((t=>{n.current&&t&&(n.current.fill=t)}),[]),l=(0,r.useCallback)((t=>{n.current&&t&&n.current.changeDelay(t)}),[]),c=(0,r.useCallback)((t=>{n.current&&(n.current.penWidth=Number(t))}),[]),u=(0,r.useCallback)((t=>{n.current&&(n.current.close=t??!1)}),[]),d=(0,r.useCallback)((t=>{n.current&&(n.current.curve=t??!0)}),[]),p=(0,r.useCallback)((()=>{n.current&&n.current.clear()}),[]),v=(0,r.useCallback)((()=>{n.current&&n.current.undo()}),[]);return(0,r.useEffect)((()=>{n.current||e.current&&(n.current=new s.hK(e.current,{...t}))})),[e,{ref:n,changePenWidth:c,changePenColor:o,changeFill:h,changeDelay:l,changeClose:u,changeCurve:d,clear:p,undo:v,getSvgXML:i,download:a}]})({curve:v,close:w,delay:j,penWidth:P,fill:b}),z=(0,i.Z)(A,2),D=z[0],M=z[1],O=(0,r.useCallback)((function(t){return function(e){M.download({extension:t})}}),[M]),T=(0,r.useCallback)((function(t){M.changeFill("none"),M.changeClose(!1),d(t.target.checked)}),[M]),I=(0,r.useCallback)((function(){M.changeCurve(!v),g(!v)}),[v,M]),V=(0,r.useCallback)((function(){M.changeClose(!w),f(!w)}),[w,M]),F=(0,r.useCallback)((function(t){var e=Number(t.target.value);Number.isNaN(e)||(M.changePenWidth(e),R(e))}),[M]),N=(0,r.useCallback)((function(t){var e=Number(t.target.value);Number.isNaN(e)||(M.changeDelay(e),S(e))}),[M]),U=(0,r.useCallback)((function(t){M.changePenColor(t),E(t)}),[M]),W=(0,r.useCallback)((function(t){U(t.target.value)}),[U]),H=(0,r.useCallback)((function(t){return function(){U(t)}}),[U]),B=(0,r.useCallback)((function(t){M.changeFill(t),C(t)}),[M]),Z=(0,r.useCallback)((function(t){B(t.target.value)}),[B]),q=(0,r.useCallback)((function(t){return function(){B(t)}}),[B]),G=(0,r.useCallback)((function(){M.clear()}),[M]),$=(0,r.useCallback)((function(){M.undo()}),[M]);(0,r.useEffect)((function(){var t=setInterval((function(){if(u){var t=c();M.changePenColor(t),E(t)}}),4*j);return function(){return clearInterval(t)}}),[j,u,M]);var J,X=(0,r.useCallback)((function(t){var e,n=new FileReader;n.onload=function(t){if(t.target&&"string"===typeof t.target.result){var e=t.target.result.split(","),n=(0,i.Z)(e,2),s=n[0],r=n[1];if("data:image/svg+xml;base64"===s){var a=atob(r);if(!M.ref.current)return;M.ref.current.svg.parseSVGString(a),M.ref.current.update()}}},null!==(e=t.target)&&void 0!==e&&e.files&&n.readAsDataURL(t.target.files[0])}),[M.ref]);return(0,h.jsxs)(o.Z,{children:[(0,h.jsx)(a.xu,{as:"fieldset",children:(0,h.jsxs)(a.kC,{flexWrap:"wrap",children:[(0,h.jsxs)(a.xu,{width:[1,.5,.5],pr:3,children:[(0,h.jsxs)(a.kC,{alignItems:"center",children:[(0,h.jsx)("label",{htmlFor:"strokeWidth",children:"STROKE WIDTH:"}),(0,h.jsx)("input",{min:"1",max:"20",step:"1",value:P,onChange:F}),(0,h.jsx)("input",{width:"auto",id:"strokeWidth",type:"number",min:"1",max:"20",step:"1",value:P,onChange:F})]}),(0,h.jsxs)(a.kC,{alignItems:"center",children:[(0,h.jsx)("label",{htmlFor:"throttleDelay",children:"THROTTLE DELAY:"}),(0,h.jsx)("input",{type:"range",min:"0",max:"300",step:"5",value:j,onChange:N}),(0,h.jsx)("input",{id:"throttleDelay",type:"number",min:"0",max:"300",step:"5",value:j,onChange:N})]}),(0,h.jsxs)(a.kC,{pt:3,justifyContent:"start",children:[(0,h.jsxs)("label",{htmlFor:"curve",children:[(0,h.jsx)("input",{type:"checkbox",id:"curve",checked:v,onChange:I}),"Curve"]}),!u&&(0,h.jsxs)("label",{htmlFor:"close",children:[(0,h.jsx)("input",{type:"checkbox",id:"close",checked:w,onChange:V}),"Close"]}),(0,h.jsxs)("label",{htmlFor:"rainbow",children:[(0,h.jsx)("input",{type:"checkbox",id:"rainbow",checked:u,onChange:T}),"Rainbow pen"]})]})]}),!u&&(0,h.jsxs)(a.xu,{width:[1,.5,.5],children:[(0,h.jsxs)("label",{htmlFor:"fill",children:["FILL:",(0,h.jsx)("input",{id:"fill",type:"text",placeholder:"#000 or black or rgba(0,0,0,1)",value:b,onChange:Z})]}),(0,h.jsx)(a.kC,{flexWrap:"wrap",children:l.map((function(t){return(0,h.jsx)(a.xu,{width:["24px","24px","20px"],height:["24px","24px","20px"],style:{display:"inline-block",backgroundColor:t,border:t===b?"2px solid #000":"2px solid #999"},onClick:q(t)},t)}))}),(0,h.jsxs)("label",{htmlFor:"penColor",style:{whiteSpace:"nowrap"},children:["PEN COLOR:",(0,h.jsx)("input",{id:"penColor",type:"text",placeholder:"#000 or black or rgba(0,0,0,1)",value:y,onChange:W})]}),(0,h.jsx)(a.kC,{flexWrap:"wrap",children:l.map((function(t){return(0,h.jsx)(a.xu,{width:["24px","24px","20px"],height:["24px","24px","20px"],bg:t,style:{border:t===y?"2px solid #000":"2px solid #999"},onClick:H(t)},t)}))})]})]})}),(0,h.jsx)(a.xu,{as:"fieldset",children:(0,h.jsxs)(a.kC,{flexWrap:"wrap",justifyContent:"start",children:[(0,h.jsxs)(a.xu,{mr:2,children:[(0,h.jsx)(a.zx,{mr:1,mb:1,onClick:G,children:"Clear"}),(0,h.jsx)(a.zx,{mr:1,mb:1,onClick:$,children:"Undo"}),(0,h.jsx)(a.zx,{variant:"secondary",mr:1,mb:1,onClick:O("png"),children:"Download PNG"}),(0,h.jsx)(a.zx,{variant:"secondary",mr:1,mb:1,onClick:O("jpg"),children:"Download JPG"}),(0,h.jsx)(a.zx,{variant:"secondary",mr:1,mb:1,onClick:O("svg"),children:"Download SVG"})]}),!e&&(0,h.jsxs)(a.xu,{width:"auto",children:[(0,h.jsx)(a.xv,{fontSize:0,children:"Svg exported by this library can be read."}),(0,h.jsx)("input",{type:"file",onChange:X,multiple:!0,accept:"image/*"})]})]})}),(0,h.jsx)(a.xu,{width:["96vw","96vw","40vw"],height:["96vw","96vw","40vw"],children:(0,h.jsx)("div",{ref:D,style:{backgroundImage:(J=30,"\n  repeating-linear-gradient(\n    90deg,\n    #ddd ,\n    #ddd 1px,\n    transparent 1px,\n    transparent ".concat(String(J),"px\n  ),\n  repeating-linear-gradient(\n    0deg,\n    #ddd ,\n    #ddd 1px,\n    transparent 1px,\n    transparent ").concat(String(J),"px\n  )\n")),backgroundSize:"".concat(30,"px ").concat(30,"px"),border:"1px solid #333",margin:"0 auto 0 0",width:"100%",height:"100%",touchAction:"none"}})})]})};u.getInitialProps=function(t){var e=t.req,n=e?e.headers["user-agent"]:navigator.userAgent;return{isSp:!n||/iPhone|Android.+Mobile/.test(n)}};var d=u},7314:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5228)}])},8529:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var i=n(7211);function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,r=[],a=!0,o=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(h){o=!0,s=h}finally{try{a||null==n.return||n.return()}finally{if(o)throw s}}return r}}(t,e)||(0,i.Z)(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},2146:function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e);if("object"!==i(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"===i(e)?e:String(e)}function r(t,e,n){return(e=s(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{CT:function(){return a},E9:function(){return c},LR:function(){return S},SE:function(){return b},Th:function(){return _},Yq:function(){return R},en:function(){return C},hK:function(){return z},lm:function(){return k},mY:function(){return d},ny:function(){return g},oT:function(){return x},uO:function(){return f},vd:function(){return o},y$:function(){return v},zt:function(){return y}});const a=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=function(t,e){return void 0===e&&(e=2),+t.toFixed(e)},h=t=>t.replace(/-([a-z])/g,((t,e)=>e.toUpperCase())),l=t=>t!=t;class c{constructor(t,e){r(this,"x",void 0),r(this,"y",void 0),this.x=t,this.y=e}toVector(){const t=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),e=Math.atan2(this.y,this.x);return new p(t,e)}scale(t){return new c(this.x*t,this.y*t)}add(t){return new c(this.x+t.x,this.y+t.y)}sub(t){return new c(this.x-t.x,this.y-t.y)}eql(t){return this.x===t.x&&this.y===t.y}clone(){return new c(this.x,this.y)}}const u={MOVE:"M",MOVE_RELATIVE:"m",LINE:"L",LINE_RELATIVE:"l",CURVE:"C",CURVE_RELATIVE:"c",CLOSE:"Z",HORIZONTAL:"H",HORIZONTAL_RELATIVE:"h",VERTICAL:"V",VERTICAL_RELATIVE:"v",ARC_CURVE:"A",ARC_CURVE_RELATIVE:"a",QUADRATIC_CURVE:"Q",QUADRATIC_CURVE_RELATIVE:"q"};class d{constructor(t,e){void 0===e&&(e=[]),r(this,"type",void 0),r(this,"value",void 0),this.value=e,this.type=t}set cr(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(2,1,t.x),this.value.splice(3,1,t.y)))}get cr(){if("C"!==this.type&&"c"!==this.type||6!==this.value.length)return;const[t,e]=this.value.slice(2,4);return new c(t,e)}set cl(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(0,1,t.x),this.value.splice(1,1,t.y)))}get cl(){if("C"!==this.type&&"c"!==this.type||6!==this.value.length)return;const[t,e]=this.value.slice(0,2);return new c(t,e)}set point(t){t&&(this.value.splice(this.value.length-2,1,t.x),this.value.splice(this.value.length-1,1,t.y))}get point(){const t=this.value.slice(this.value.length-2);return 2===t.length?new c(t[0],t[1]):void 0}toString(){return this.type===u.CLOSE?u.CLOSE:`${this.type} ${this.value.map((t=>o(t))).join(" ")}`}scale(t){return new d(this.type,this.value.map((e=>e*t)))}clone(){return new d(this.type,this.value.slice())}}class p{constructor(t,e){r(this,"angle",void 0),r(this,"value",void 0),this.value=t,this.angle=e}toPoint(){const t=Math.cos(this.angle)*this.value,e=Math.sin(this.angle)*this.value;return new c(t,e)}scale(t){return new p(this.value*t,this.angle)}}class v{constructor(t){let{d:e,...n}=void 0===t?{}:t;r(this,"attrs",void 0),r(this,"commands",void 0),this.attrs=n,this.commands=[],e&&this.parseCommandString(e)}scale(t){return this.commands=this.commands.map((e=>e.scale(t))),this.attrs.strokeWidth=String(t*+(this.attrs.strokeWidth||0)),this}addCommand(t){return Array.isArray(t)?this.commands.push(...t):this.commands.push(t),this}getCommandString(){return 0===this.commands.length?"":this.commands.map(((t,e)=>t.toString())).join(" ").trim()}parseCommandString(t){this.commands=[];let e=null,n=[];const i=t.split(" "),s=t=>Object.values(u).includes(t)?t:null;for(let r=0;r<i.length;r+=1){const t=s(i[r]);if(t){if(!e){e=t;continue}this.commands.push(new d(e,n)),e=t,n=[]}else{if(l(+i[r]))return;n.push(+i[r])}}null!==e&&this.commands.push(new d(e,n))}parsePathElement(t){for(let e=0;e<t.attributes.length;e+=1){const n=t.attributes.item(e);n&&n.value&&("d"!==n.name?this.attrs={...this.attrs,[h(n.name)]:n.value}:this.parseCommandString(n.value))}return this}toJson(){return{...this.attrs,d:this.getCommandString()}}clone(){const t=new v(this.attrs);return this.commands.map((e=>{t.commands.push(e.clone())})),t}}class g{constructor(t){let{width:e,height:n,background:i}=t;r(this,"paths",void 0),r(this,"width",void 0),r(this,"height",void 0),r(this,"background",void 0),this.paths=[],this.width=e,this.height=n,this.background=i}resize(t){let{width:e,height:n}=t;this.scalePath(e/this.width),this.width=e,this.height=n}scalePath(t){if(1!==t)for(let e=0;e<this.paths.length;e+=1)this.paths[e].scale(t);return this}addPath(t){return Array.isArray(t)?this.paths.push(...t):this.paths.push(t),this}clonePaths(){return this.paths.map((t=>t.clone()))}updatePath(t,e){const n=e||this.paths.length-1;return n<0&&this.paths.push(t),this.paths[n]=t,this}toJson(){return{width:this.width,height:this.height,background:this.background,paths:this.paths.map((t=>t.toJson()))}}copy(t){return this.paths=t.clonePaths(),t.width&&this.width&&this.scalePath(this.width/t.width),this}parseSVGString(t){const e=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");return e?this.parseSVGElement(e):(this.paths=[],this)}parseSVGElement(t){const e=[];t.querySelectorAll("path").forEach((t=>{const n=(new v).parsePathElement(t);0!==n.commands.length&&e.push(n)})),this.paths=e;const n=Number(t.getAttribute("width"));return n&&this.width&&this.scalePath(this.width/n),this}}class m{constructor(t){let{ratio:e}=void 0===t?{}:t;r(this,"ratio",void 0),this.ratio=e??.2}_controlPoint(t,e,n){const i=new c(t.x,t.y),s=new c(e.x,e.y),r=new c(n.x,n.y).sub(i).toVector().scale(this.ratio).toPoint(),a=s.add(r);return[a.x,a.y]}bezierCurve(t,e,n,i){const s=[...this._controlPoint(t,e,n),...this._controlPoint(i,n,e),n.x,n.y];return new d(u.CURVE,s)}lineCommands(t){return t.map(((t,e)=>new d(0===e?u.MOVE:u.LINE,[t.x,t.y])))}bezierCurveCommands(t){const e=[];if(t.length<3)return this.lineCommands(t);for(let n=0;n<t.length;n+=1)0!==n?e.push(this.bezierCurve(t[n-2<0?0:n-2],t[n-1],t[n],n<t.length-1?t[n+1]:t[n])):e.push(new d(u.MOVE,[t[n].x,t[n].y]));return e}}const w="http://www.w3.org/2000/svg",f=(t,e)=>{const n=document.createElementNS(w,"svg");return n.setAttributeNS(null,"version","1.1"),n.setAttribute("xmlns",w),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Object.keys(t).sort().map((e=>{n.setAttribute(e,t[e])})),e.map((t=>{n.appendChild(t)})),n},x=(t,e)=>{const n=document.createElementNS(w,t);return Object.keys(e).sort().map((t=>{n.setAttribute(t,e[t])})),n},b=t=>{const e=Object.entries(t).reduce(((t,e,n)=>{let[i,s]=e;return s?{...t,[a(i)]:s}:t}),{});return x("path",e)},C=t=>{let{width:e,height:n,background:i,paths:s}=t;const r={width:String(e),height:String(n)},a=i?[x("rect",{...r,fill:i})]:[];return f(r,[...a,...s.map(b)])};class _{constructor(t,e){let{background:n}=void 0===e?{}:e;this.el=t;const{width:i,height:s}=t.getBoundingClientRect();t.appendChild(C({background:n,width:i,height:s,paths:[]}))}update(t){this.el.replaceChild(C(t),this.el.childNodes[0])}}const y=t=>`data:image/svg+xml;base64,${btoa(t)}`,E={png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml"},k=t=>{let{data:e,extension:n,filename:i}=t;const s=atob(e.replace(/^.*,/,"")),r=new Uint8Array(s.length);for(let h=0;h<s.length;h+=1)r[h]=s.charCodeAt(h);const a=i||`${Date.now()}.${n}`,o=new Blob([r.buffer],{type:E[n]});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,a);else if(window.URL&&window.URL.createObjectURL){const t=document.createElement("a");t.download=a,t.href=window.URL.createObjectURL(o),document.body.appendChild(t),t.click(),document.body.removeChild(t)}else window.open(e,"_blank")},j={extension:"svg"},S=function(t,e,n){void 0===e&&(e=j),void 0===n&&(n=k);const{filename:i,extension:s}={...j,...e},r=(t=>y(C(t).outerHTML))(t.toJson());if("svg"===s)return void n({data:r,extension:"svg",filename:i});const{width:a,height:o,background:h}=t,l=new Image;l.addEventListener("load",(()=>{const t=document.createElement("canvas");t.setAttribute("width",String(a)),t.setAttribute("height",String(o));const e=t.getContext("2d");e&&((h||"jpg"===s)&&(e.fillStyle=h||"#fff",e.fillRect(0,0,a,o)),e.drawImage(l,0,0),n("png"===s?{data:t.toDataURL("image/png"),extension:"png"}:{data:t.toDataURL("image/jpeg"),extension:"jpg"}))}),!1),l.src=r},L={pointer:{start:["pointerdown"],move:["pointermove"],end:["pointerleave","pointercancel"],frameout:["pointerup"]},touch:{start:["touchstart"],move:["touchmove"],end:["touchend"],frameout:["touchcancel"]},mouse:{start:["mousedown"],move:["mousemove"],end:["mouseleave","mouseout"],frameout:["mouseup"]}};class P{constructor(t,e){let{end:n,start:i,move:s}=e;this._el=t,r(this,"_clearEventList",void 0),r(this,"_listenerOption",void 0),r(this,"_left",void 0),r(this,"_top",void 0),r(this,"end",void 0),r(this,"start",void 0),r(this,"move",void 0),this.end=n,this.start=i,this.move=s,this._clearEventList=[],this._listenerOption=function(t){void 0===t&&(t=!0);try{const e=()=>null;return addEventListener("testPassive",e,{passive:t}),removeEventListener("testPassive",e),{passive:t}}catch(t){return!1}}(!1);const{left:a,top:o}=t.getBoundingClientRect();this._left=a,this._top=o,this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this)}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._setupCoordinatesListener(),window.PointerEvent?this._setupDrawListener("pointer"):this._setupDrawListener("mouse"),"ontouchstart"in window&&this._setupDrawListener("touch")}_handleStart(t){t.preventDefault(),this.start()}_handleEnd(t){t.preventDefault(),this.end()}_handleMove(t){if(t.preventDefault(),t instanceof TouchEvent){const e=t.touches[0];this.move({x:e.clientX-this._left,y:e.clientY-this._top,pressure:e.force})}else t instanceof PointerEvent?this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:t.pressure}):t instanceof MouseEvent&&this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:t?.pressure})}_setupDrawListener(t){const{start:e,move:n,end:i,frameout:s}=L[t],r=e.map((t=>(this._el.addEventListener(t,this._handleStart,this._listenerOption),()=>this._el.removeEventListener(t,this._handleStart)))),a=n.map((t=>(this._el.addEventListener(t,this._handleMove,this._listenerOption),()=>this._el.removeEventListener(t,this._handleMove)))),o=i.map((t=>(this._el.addEventListener(t,this._handleEnd,this._listenerOption),()=>this._el.removeEventListener(t,this._handleEnd)))),h=s.map((t=>(addEventListener(t,this._handleEnd,this._listenerOption),()=>removeEventListener(t,this._handleEnd))));this._clearEventList.push(...r,...a,...o,...h)}_setupCoordinatesListener(){const t=t=>{const{left:e,top:n}=this._el.getBoundingClientRect();this._left=e,this._top=n};addEventListener("scroll",t),this._el.addEventListener("resize",t),this._clearEventList.push((()=>{removeEventListener("scroll",t),this._el.removeEventListener("resize",t)}))}}class R{constructor(t,e){let{resize:n}=e;this._el=t,r(this,"_clearEventList",void 0),r(this,"resize",void 0),this.resize=n,this._clearEventList=[]}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._setupListerner()}_setupListerner(){if(window.ResizeObserver){const t=new window.ResizeObserver((t=>{let[e]=t;this.resize(e.contentRect)}));t.observe(this._el),this._clearEventList.push((()=>t.disconnect()))}else{const t=()=>{this.resize(this._el.getBoundingClientRect())};addEventListener("resize",t),this._clearEventList.push((()=>removeEventListener("resize",t)))}}}function A(t,e,n){let i,s,r;void 0===n&&(n={});let a=null,o=0;const h=()=>{o=!1===n.leading?0:Date.now(),a=null,r=t.apply(i,s),a||(i=null,s=null)},l=()=>{a&&(clearTimeout(a),a=null)};return function(){const c=Date.now();o||!1!==n.leading||(o=c);const u=e-(c-o);i=this;for(var d=arguments.length,p=new Array(d),v=0;v<d;v++)p[v]=arguments[v];return s=p,u<=0||u>e?(l(),o=c,r=t.apply(i,s),a||(i=null,s=null)):a||!1===n.trailing||(a=setTimeout(h,u)),r}}class z{constructor(t,e){let{penColor:n,penWidth:i,curve:s,close:a,delay:o,fill:h,background:l}=void 0===e?{}:e;this.el=t,r(this,"penColor",void 0),r(this,"penWidth",void 0),r(this,"fill",void 0),r(this,"curve",void 0),r(this,"close",void 0),r(this,"delay",void 0),r(this,"svg",void 0),r(this,"convert",void 0),r(this,"renderer",void 0),r(this,"drawHandler",void 0),r(this,"resizeHandler",void 0),r(this,"_drawPath",void 0),r(this,"_drawPoints",void 0),r(this,"_drawMoveThrottle",void 0),this.penColor=n??"#000",this.penWidth=i??1,this.curve=s??!0,this.close=a??!1,this.delay=o??0,this.fill=h??"none";const{width:c,height:u}=t.getBoundingClientRect();this._drawPath=null,this._drawPoints=[],this.svg=new g({width:c,height:u,background:l}),this.renderer=new _(t,{background:l}),this.convert=new m,this._resize=this._resize.bind(this),this.resizeHandler=new R(t,{resize:this._resize}),this.drawStart=this.drawStart.bind(this),this.drawMove=this.drawMove.bind(this),this._drawMoveThrottle=A(this.drawMove,this.delay),this.drawEnd=this.drawEnd.bind(this),this.drawHandler=new P(t,{start:this.drawStart,move:this._drawMoveThrottle,end:this.drawEnd}),this.on()}update(){this.renderer.update(this.svg.toJson())}clear(){const t=this.svg.paths;return this.svg.paths=[],this.update(),t}undo(){const t=this.svg.paths.pop();return this.update(),t}changeDelay(t){this.delay=t,this.drawHandler.move=A(this.drawMove,this.delay),this.drawHandler.on()}on(){this.drawHandler.on(),this.resizeHandler.on()}off(){this.drawHandler.off(),this.resizeHandler.off()}drawStart(){this._drawPath||(this._drawPath=this._createDrawPath(),this.svg.addPath(this._drawPath))}drawMove(t){this._drawPath&&(this._addDrawPoint(t),(this._drawPath.attrs.strokeWidth&&+this._drawPath.attrs.strokeWidth!==this.penWidth||this._drawPath.attrs.stroke!==this.penColor)&&(this._drawPath=this._createDrawPath(),this._addDrawPoint(t),this.svg.addPath(this._drawPath)),this.update())}drawEnd(){this._drawPath=null,this.update()}_createCommand(){this._drawPath&&(this.curve?this._drawPath.commands=this.convert.bezierCurveCommands(this._drawPoints):this._drawPath.commands=this.convert.lineCommands(this._drawPoints),this.close&&this._drawPath.commands.push(new d(u.CLOSE)))}_addDrawPoint(t){this._drawPoints.push(t),this._createCommand()}_createDrawPath(){return this._resize(this.el.getBoundingClientRect()),this._drawPoints=[],new v({stroke:this.penColor,strokeWidth:String(this.penWidth),fill:this.fill,strokeLinecap:this.curve?"round":"mitter",strokeLinejoin:this.curve?"round":"square"})}_resize(t){let{width:e,height:n}=t;((t,e)=>Math.trunc(t)===Math.trunc(e))(this.svg.width,e)||(this.svg.resize({width:e,height:n}),this.update())}download(t){S(this.svg,t)}}}},function(t){t.O(0,[61,774,888,179],(function(){return e=7314,t(t.s=e);var e}));var e=t.O();_N_E=e}]);