(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[106],{3554:function(t,e,n){"use strict";var i,s=n(7328),r=n(1628),o=n(7729),a=n.n(o),h=n(9097),l=n.n(h),c=n(2784),d=n(6451),u=n(8694),p=n(2322),g=(0,u.createGlobalStyle)(i||(i=(0,s.Z)(["\n body, * {\n   margin: 0;\n   box-sizing: border-box;\n }\n\n  a {\n    color: initial;\n    text-decoration: initial;\n  }\n"]))),m=function(){return(0,p.jsx)(d.xu,{bg:"#fafafa",py:"8px",px:"16px",children:(0,p.jsxs)(d.kC,{justifyContent:"space-between",children:[(0,p.jsx)(d.xu,{width:.3,children:(0,p.jsx)(l(),{href:"/",children:(0,p.jsx)("a",{children:(0,p.jsx)(d.xv,{fontSize:3,as:"h1",style:{whiteSpace:"nowrap"},children:"svg-drawing"})})})}),(0,p.jsxs)(d.kC,{as:"nav",alignContent:"center",width:.6,children:[(0,p.jsx)(l(),{href:"/",children:(0,p.jsx)("a",{children:(0,p.jsx)(d.xv,{mr:2,children:"drawing"})})}),(0,p.jsx)(d.xv,{mr:2,children:(0,p.jsx)(l(),{href:"/demo/animation",children:(0,p.jsx)("a",{children:"animation"})})}),(0,p.jsx)(d.xv,{mr:2,children:(0,p.jsx)(l(),{href:"/demo/img-trace",children:(0,p.jsx)("a",{children:"img-trace"})})})]}),(0,p.jsx)(d.xu,{width:.1,style:{textAlign:"right"},children:(0,p.jsx)(d.rU,{color:"#000",href:"https://github.com/kmkzt/svg-drawing",children:(0,p.jsx)(r.X,{size:"24"})})})]})})};e.Z=function(t){var e=t.children,n=t.title,i=void 0===n?"":n;return(0,p.jsxs)(c.Fragment,{children:[(0,p.jsx)(a(),{children:(0,p.jsx)("title",{children:"svg-drawing ".concat(i)})}),(0,p.jsx)(g,{}),(0,p.jsx)(m,{}),(0,p.jsx)(d.xu,{py:"12px",px:["2vw","2vw","5vw"],children:e})]})}},2637:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return L}});var i=n(1512);var s=n(7211);function r(t){return function(t){if(Array.isArray(t))return(0,i.Z)(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||(0,s.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=n(5235);function a(t,e,n,i,s,r,o){try{var a=t[r](o),h=a.value}catch(l){return void n(l)}a.done?e(h):Promise.resolve(h).then(i,s)}function h(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var r=t.apply(e,n);function o(t){a(r,i,s,o,h,"next",t)}function h(t){a(r,i,s,o,h,"throw",t)}o(void 0)}))}}var l=n(8526),c=n.n(l),d=n(2146);function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const p=t=>{const e=t.width*t.height;if(!(t.data.length<4*e))return t;const n=new Uint8ClampedArray(4*e);for(let i=0;i<e;i++)n[4*i]=t.data[3*i],n[4*i+1]=t.data[3*i+1],n[4*i+2]=t.data[3*i+2],n[4*i+3]=255;return{...t,data:n}};class g{constructor(t){u(this,"corsenabled",void 0),this.corsenabled=t.corsenabled??!0}fromUrl(t,e){const n=(e,n)=>{const i=new Image;this.corsenabled&&(i.crossOrigin="Anonymous"),i.onload=()=>{this.fromImageElement(i,e)},i.onerror=t=>{n?n(t):console.error(t)},i.src=t};if(!e)return new Promise(n);n(e)}fromImageElement(t,e){const n=(e,n)=>{const i=document.createElement("canvas");i.width=t.naturalWidth||t.width,i.height=t.naturalHeight||t.height;const s=i.getContext("2d");null==s||s.drawImage(t,0,0);const r=null==s?void 0:s.getImageData(0,0,i.width,i.height);if(!r){if(n)return void n("error canvas context.");throw"error canvas context."}e(r)};if(!e)return new Promise(n);n(e)}}const m=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],v=[{r:0,g:0,b:0,a:255},{r:50,g:50,b:50,a:255},{r:100,g:100,b:100,a:255},{r:150,g:150,b:150,a:255},{r:200,g:200,b:200,a:255}];class f{constructor(t){void 0===t&&(t={}),u(this,"ltres",void 0),u(this,"qtres",void 0),u(this,"rightangleenhance",void 0),u(this,"pathOmit",void 0),u(this,"commandOmit",void 0),u(this,"pathAttrs",void 0),u(this,"palettes",void 0),this.ltres=t.ltres??1,this.qtres=t.qtres??1,this.rightangleenhance=t.rightangleenhance??!0,this.pathOmit=t.pathOmit??8,this.commandOmit=t.commandOmit??0,this.pathAttrs={strokeWidth:"1",...t.pathAttrs||{}},this.palettes=t.palettes||v}load(t){const e=p(t),n=this._colorQuantization(e),i=[];for(let r=0;r<this.palettes.length;r++){const t=this._edgeDetection(n,r),e=this._pathScan(t),s=this._interpolation(e).map(this._tracePath.bind(this));i.push(s)}const s=this._createPaths(i);return new d.ny({width:n[0].length-2,height:n.length-2}).addPath(s)}_colorQuantization(t){return Array.from({length:t.height+2},((e,n)=>Array.from({length:t.width+2},((e,i)=>{if(0===i||i===t.width+1||0===n||n===t.height+1)return-1;const s=i-1,r=4*((n-1)*t.width+s);return this._findPaletteIndex({r:t.data[r],g:t.data[r+1],b:t.data[r+2],a:t.data[r+3]})}))))}_findPaletteIndex(t){let{r:e,g:n,b:i,a:s}=t,r=1024;return this.palettes.reduce(((t,o,a)=>{const h=Math.abs(o.r-e)+Math.abs(o.g-n)+Math.abs(o.b-i)+Math.abs(o.a-s);return h<r?(r=h,a):t}),0)}_edgeDetection(t,e){const n=[],i=t.length,s=t[0].length;for(let r=0;r<i;r++){n[r]=[];for(let i=0;i<s;i++)n[r][i]=0===r||0===i?0:(t[r-1][i-1]===e?1:0)+(t[r-1][i]===e?2:0)+(t[r][i-1]===e?8:0)+(t[r][i]===e?4:0)}return n}_pointpoly(t,e){let n=!1;for(let i=0,s=e.length-1;i<e.length;s=i++)n=e[i].y>t.y!=e[s].y>t.y&&t.x<(e[s].x-e[i].x)*(t.y-e[i].y)/(e[s].y-e[i].y)+e[i].x?!n:n;return n}_pathScan(t){const e=t[0].length,n=t.length,i=[];let s=0;for(let r=0;r<n;r++)for(let o=0;o<e;o++){const a=t[r][o];if(4!==a&&11!==a)continue;let h=o,l=r,c=1,d=0,u=!1;for(i[s]={points:[],boundingbox:[h,l,h,l],holechildren:[],isholepath:!1};!u;){i[s].points[d]={x:h-1,y:l-1,direction:-1},h-1<i[s].boundingbox[0]&&(i[s].boundingbox[0]=h-1),h-1>i[s].boundingbox[2]&&(i[s].boundingbox[2]=h-1),l-1<i[s].boundingbox[1]&&(i[s].boundingbox[1]=l-1),l-1>i[s].boundingbox[3]&&(i[s].boundingbox[3]=l-1);const r=m[t[l][h]][c];if(t[l][h]=r[0],c=r[1],h+=r[2],l+=r[3],h-1===i[s].points[0].x&&l-1===i[s].points[0].y)if(u=!0,i[s].points.length<this.pathOmit)i.pop();else{if(11===a){i[s].isholepath=!0;let t=0,r=[-1,-1,e+1,n+1];for(let e=0;e<s;e++)!i[e].isholepath&&this._boundingboxincludes(i[e].boundingbox,i[s].boundingbox)&&this._boundingboxincludes(r,i[e].boundingbox)&&this._pointpoly(i[s].points[0],i[e].points)&&(t=e,r=i[e].boundingbox);i[t].holechildren.push(s)}s++}d++}}return i}_boundingboxincludes(t,e){return t[0]<e[0]&&t[1]<e[1]&&t[2]>e[2]&&t[3]>e[3]}_interpolation(t){const e=[];let n=0,i=0,s=0,r=0;for(let o=0;o<t.length;o++){e[o]={points:[],boundingbox:t[o].boundingbox,holechildren:t[o].holechildren,isholepath:t[o].isholepath};const a=t[o].points.length;for(let h=0;h<a;h++)n=(h+1)%a,i=(h+2)%a,s=(h-1+a)%a,r=(h-2+a)%a,this.rightangleenhance&&this._testrightangle(t[o],r,s,h,n,i)&&(e[o].points.length>0&&(e[o].points[e[o].points.length-1].direction=this._getdirection(e[o].points[e[o].points.length-1].x,e[o].points[e[o].points.length-1].y,t[o].points[h].x,t[o].points[h].y)),e[o].points.push({x:t[o].points[h].x,y:t[o].points[h].y,direction:this._getdirection(t[o].points[h].x,t[o].points[h].y,(t[o].points[h].x+t[o].points[n].x)/2,(t[o].points[h].y+t[o].points[n].y)/2)})),e[o].points.push({x:(t[o].points[h].x+t[o].points[n].x)/2,y:(t[o].points[h].y+t[o].points[n].y)/2,direction:this._getdirection(t[o].points[h].x+t[o].points[n].x,t[o].points[h].y+t[o].points[n].y,t[o].points[n].x+t[o].points[i].x,t[o].points[n].y+t[o].points[i].y)})}return e}_testrightangle(t,e,n,i,s,r){return t.points[i].x===t.points[e].x&&t.points[i].x===t.points[n].x&&t.points[i].y===t.points[s].y&&t.points[i].y===t.points[r].y||t.points[i].y===t.points[e].y&&t.points[i].y===t.points[n].y&&t.points[i].x===t.points[s].x&&t.points[i].x===t.points[r].x}_getdirection(t,e,n,i){return t<n?e<i?1:7:t>n?e<i?3:e>i?5:4:e<i?2:e>i?6:8}_tracePath(t){let e=0;const n=[],i=[];for(;e<t.points.length;){const s=t.points[e].direction;let r=-1,o=e+1;for(;(t.points[o].direction===s||t.points[o].direction===r||-1===r)&&o<t.points.length-1;)t.points[o].direction!==s&&-1===r&&(r=t.points[o].direction||0),o++;o===t.points.length-1?(n.push(...this._fitseq(t,e,0)),i.push(...this._fitseq(t,e,0,!0)),e=t.points.length):(n.push(...this._fitseq(t,e,o)),i.push(...this._fitseq(t,e,o,!0)),e=o)}const s=[new d.mY("M",[t.points[0].x,t.points[0].y]),...n,new d.mY("Z")];return i.reverse(),{commands:s,holeCommands:[new d.mY("M",i[i.length-1].value.slice(0,2)),...i,new d.mY("Z")],holechildren:t.holechildren,isholepath:t.isholepath}}_fitseq(t,e,n,i){const s=this.ltres,r=this.qtres;if(n>t.points.length||n<0)return[];let o,a,h,l=e,c=0,u=!0,p=n-e;p<0&&(p+=t.points.length);const g=(t.points[n].x-t.points[e].x)/p,m=(t.points[n].y-t.points[e].y)/p;let v=(e+1)%t.points.length;for(;v!=n;){let n=v-e;n<0&&(n+=t.points.length),o=t.points[e].x+g*n,a=t.points[e].y+m*n,h=(t.points[v].x-o)*(t.points[v].x-o)+(t.points[v].y-a)*(t.points[v].y-a),h>s&&(u=!1),h>c&&(l=v,c=h),v=(v+1)%t.points.length}if(u)return[new d.mY("L",i?[t.points[e].x,t.points[e].y]:[t.points[n].x,t.points[n].y])];const f=l;u=!0,c=0;let w=(f-e)/p,x=(1-w)*(1-w),b=2*(1-w)*w,_=w*w;const y=(x*t.points[e].x+_*t.points[n].x-t.points[f].x)/-b,E=(x*t.points[e].y+_*t.points[n].y-t.points[f].y)/-b;for(v=e+1;v!=n;)w=(v-e)/p,x=(1-w)*(1-w),b=2*(1-w)*w,_=w*w,o=x*t.points[e].x+b*y+_*t.points[n].x,a=x*t.points[e].y+b*E+_*t.points[n].y,h=(t.points[v].x-o)*(t.points[v].x-o)+(t.points[v].y-a)*(t.points[v].y-a),h>r&&(u=!1),h>c&&(l=v,c=h),v=(v+1)%t.points.length;if(u)return[new d.mY("Q",[y,E,t.points[n].x,t.points[n].y])];const C=f;return this._fitseq(t,e,C,i).concat(this._fitseq(t,C,n,i))}_complementCommand(t,e){const n=t[e],i=[];for(let s=0;s<n.holechildren.length;s++)i.push(...t[n.holechildren[s]].holeCommands);return i}_createPaths(t){const e=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].length;i++){const s=t[n],r=s[i];if(r.isholepath||r.commands.length<this.commandOmit)continue;const o=this.palettes[n],a=`rgb(${o.r}, ${o.g}, ${o.b})`,h=new d.y$({...this.pathAttrs,stroke:a,fill:a,opacity:String(o.a/255)});h.addCommand([...r.commands,...this._complementCommand(s,i)]),e.push(h)}return e}}var w=n(2784),x=n(6451),b=n(3554),_=n(4406).env.BASE_PATH||"",y=n(2322);function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function C(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){(0,o.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j=["/img_trace/cat.jpg","/img_trace/harinezumi.jpg","/img_trace/kuma.jpg","/img_trace/panda.png","/img_trace/risu.jpg","/img_trace/tanuki.jpg"].map((function(t){return"".concat(_).concat(t)})),P=[{r:0,g:0,b:0,a:255},{r:50,g:50,b:50,a:255},{r:100,g:100,b:100,a:255},{r:150,g:150,b:150,a:255},{r:200,g:200,b:200,a:255}],L=function(){var t=(0,w.useState)(j),e=t[0],n=t[1],i=(0,w.useState)(P),s=i[0],o=i[1],a=(0,w.useState)(),l=a[0],u=a[1],m=(0,w.useState)({numberOfColors:8,colorQuantCycles:3})[0],v=(0,w.useState)({})[0],_=(0,w.useState)(j[0]),E=_[0],L=_[1],k=(0,w.useState)(""),S=k[0],O=k[1],M=(0,w.useState)(),A=M[0],z=M[1],R=(0,w.useRef)(null),D=(0,w.useRef)(null),I=(0,w.useCallback)((function(t){O(t.target.value)}),[O]),T=(0,w.useCallback)((function(){l&&o(class{static imageData(t,e){let{numberOfColors:n,colorQuantCycles:i}=void 0===e?{}:e;const s=n||16,r=i||3,o=p(t),a=this._deterministic(o,s);let h=[];for(let l=0;l<r;l++){if(l>0)for(let t=0;t<a.length;t++)h[t].n>0&&(a[t]={r:Math.floor(h[t].r/h[t].n),g:Math.floor(h[t].g/h[t].n),b:Math.floor(h[t].b/h[t].n),a:Math.floor(h[t].a/h[t].n)});h=Array.from({length:a.length},(()=>({r:0,g:0,b:0,a:0,n:0})));for(let t=0;t<o.height;t++)for(let e=0;e<o.width;e++){const n=4*(t*o.width+e);let i=1024;const s=a.reduce(((t,e,s)=>{const r=Math.abs(e.r-o.data[n])+Math.abs(e.g-o.data[n+1])+Math.abs(e.b-o.data[n+2])+Math.abs(e.a-o.data[n+3]);return r<i?(i=r,s):t}),0);h[s].r+=o.data[n],h[s].g+=o.data[n+1],h[s].b+=o.data[n+2],h[s].a+=o.data[n+3],h[s].n+=1}}return a}static _deterministic(t,e){const n=[],i=Math.ceil(Math.sqrt(e)),s=Math.ceil(e/i),r=t.width/(i+1),o=t.height/(s+1);for(let a=0;a<s;a++)for(let s=0;s<i&&n.length!==e;s++){const e=4*Math.floor((a+1)*o*t.width+(s+1)*r);n.push({r:t.data[e],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]})}return n}static number(t){if(void 0===t&&(t=16),t<8)return this.grey(t);const e=[],n=Math.floor(Math.pow(t,1/3)),i=Math.floor(255/(n-1));for(let r=0;r<n;r+=1)for(let t=0;t<n;t+=1)for(let s=0;s<n;s+=1)e.push({r:r*i,g:t*i,b:s*i,a:255});const s=t-n*n*n;for(let r=0;r<s;r++)e.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});return e}static grey(t){void 0===t&&(t=16);const e=[],n=Math.floor(255/(t-1));for(let i=0;i<t;i++)e.push({r:i*n,g:i*n,b:i*n,a:255});return e}}.imageData(l,m))}),[m,o,l]),V=(0,w.useCallback)((function(){o(P)}),[o]),U=(0,w.useCallback)((function(t){return function(){var e=s.filter((function(e,n){return n!==t}));o(e)}}),[o,s]),q=(0,w.useCallback)(h(c().mark((function t(){var e,n,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,t.t0=l,t.t0){t.next=6;break}return t.next=5,new g({corsenabled:!0}).fromUrl(E);case 5:t.t0=t.sent;case 6:if(e=t.t0,!l&&e&&u(e),e){t.next=10;break}return t.abrupt("return");case 10:n=new f(C(C({},v),{},{palettes:s})),i=n.load(e),z(i),n.palettes&&o(n.palettes),t.next=18;break;case 16:t.prev=16,t.t1=t.catch(0);case 18:case"end":return t.stop()}}),t,null,[[0,16]])}))),[E,l,s,v]);(0,w.useEffect)((function(){if(D.current){var t=function(){if(D.current&&A){var t=new d.Th(D.current),e=D.current.getBoundingClientRect(),n=e.width,i=e.height;A.resize({width:n,height:i}),t.update(A.toJson())}};return t(),window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}}),[A]);var H=(0,w.useCallback)((function(t){return function(){L(t),e.includes(t)||n([].concat(r(e),[t]))}}),[L,e]),N=(0,w.useCallback)((function(){A&&(0,d.LR)(A)}),[A]);return(0,w.useEffect)((function(){R.current&&(R.current.onload=function(){R.current&&new g({corsenabled:!0}).fromImageElement(R.current,u)})}),[u]),(0,y.jsxs)(b.Z,{children:[(0,y.jsxs)(x.kC,{justifyContent:"start",flexWrap:"wrap",children:[(0,y.jsxs)(x.xu,{mb:3,children:[(0,y.jsx)(x.zx,{mr:2,mb:2,onClick:T,children:"Load Image Palette!"}),(0,y.jsx)(x.zx,{mr:2,mb:2,onClick:V,children:"GrayScale Palette!"}),(0,y.jsx)(x.kC,{justifyContent:"start",py:"2px",px:"0",children:s.sort((function(t,e){return t.r+t.g+t.b>e.r+e.g+e.b?-1:1})).map((function(t,e){return(0,y.jsx)("div",{style:{width:30,height:30,margin:2,position:"relative",backgroundColor:"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a/255,")")},children:(0,y.jsx)("div",{style:{position:"absolute",background:"#fff",bottom:2,left:2,width:8,lineHeight:"8px",textAlign:"center",fontSize:3,cursor:"pointer"},onMouseUp:U(e),children:"x"})},e)}))})]}),(0,y.jsxs)(x.xu,{mb:3,children:[(0,y.jsx)(x.zx,{mr:2,mb:2,variant:"secondary",onClick:q,children:"Image Trace!"}),A&&(0,y.jsx)(x.zx,{mr:2,mb:2,onClick:N,children:"Download"}),(0,y.jsxs)(x.kC,{justifyContent:"start",flexWrap:"wrap",children:[(0,y.jsx)(x.xu,{width:["80vw","80vw","30vw"],height:["80vw","80vw","30vw"],children:(0,y.jsx)(x.Ee,{width:"100%",ref:R,crossOrigin:"anonymous",src:E,alt:""})}),(0,y.jsx)(x.xu,{width:["80vw","80vw","30vw"],height:["80vw","80vw","30vw"],children:(0,y.jsx)("div",{style:{width:"100%",height:"100%"},ref:D})})]})]})]}),(0,y.jsxs)(x.xu,{as:"fieldset",children:[(0,y.jsx)(x.X6,{children:"Select Image"}),(0,y.jsxs)(x.xu,{children:[(0,y.jsx)("input",{type:"text",placeholder:"input image url",value:S,onChange:I}),(0,y.jsx)(x.zx,{onClick:H(S),children:"Load image url"})]}),(0,y.jsx)(x.kC,{flexWrap:"wrap",children:e.map((function(t,e){return(0,y.jsx)(x.Zb,{width:"256px",children:(0,y.jsx)(x.Ee,{src:t,alt:t,onClick:H(t)})},e)}))})]})]})}},545:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/demo/img-trace",function(){return n(2637)}])},2146:function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{CT:function(){return s},E9:function(){return h},LR:function(){return j},SE:function(){return w},Th:function(){return b},Yq:function(){return k},en:function(){return x},hK:function(){return O},lm:function(){return E},mY:function(){return c},ny:function(){return p},oT:function(){return f},uO:function(){return v},vd:function(){return r},y$:function(){return u},zt:function(){return _}});const s=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=function(t,e){return void 0===e&&(e=2),+t.toFixed(e)},o=t=>t.replace(/-([a-z])/g,((t,e)=>e.toUpperCase())),a=t=>t!=t;class h{constructor(t,e){i(this,"x",void 0),i(this,"y",void 0),this.x=t,this.y=e}toVector(){const t=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),e=Math.atan2(this.y,this.x);return new d(t,e)}scale(t){return new h(this.x*t,this.y*t)}add(t){return new h(this.x+t.x,this.y+t.y)}sub(t){return new h(this.x-t.x,this.y-t.y)}eql(t){return this.x===t.x&&this.y===t.y}clone(){return new h(this.x,this.y)}}const l={MOVE:"M",MOVE_RELATIVE:"m",LINE:"L",LINE_RELATIVE:"l",CURVE:"C",CURVE_RELATIVE:"c",CLOSE:"Z",HORIZONTAL:"H",HORIZONTAL_RELATIVE:"h",VERTICAL:"V",VERTICAL_RELATIVE:"v",ARC_CURVE:"A",ARC_CURVE_RELATIVE:"a",QUADRATIC_CURVE:"Q",QUADRATIC_CURVE_RELATIVE:"q"};class c{constructor(t,e){void 0===e&&(e=[]),i(this,"type",void 0),i(this,"value",void 0),this.value=e,this.type=t}set cr(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(2,1,t.x),this.value.splice(3,1,t.y)))}get cr(){if("C"!==this.type&&"c"!==this.type||6!==this.value.length)return;const[t,e]=this.value.slice(2,4);return new h(t,e)}set cl(t){t&&("C"!==this.type&&"c"!==this.type||6!==this.value.length||(this.value.splice(0,1,t.x),this.value.splice(1,1,t.y)))}get cl(){if("C"!==this.type&&"c"!==this.type||6!==this.value.length)return;const[t,e]=this.value.slice(0,2);return new h(t,e)}set point(t){t&&(this.value.splice(this.value.length-2,1,t.x),this.value.splice(this.value.length-1,1,t.y))}get point(){const t=this.value.slice(this.value.length-2);return 2===t.length?new h(t[0],t[1]):void 0}toString(){return this.type===l.CLOSE?l.CLOSE:`${this.type} ${this.value.map((t=>r(t))).join(" ")}`}scale(t){return new c(this.type,this.value.map((e=>e*t)))}clone(){return new c(this.type,this.value.slice())}}class d{constructor(t,e){i(this,"angle",void 0),i(this,"value",void 0),this.value=t,this.angle=e}toPoint(){const t=Math.cos(this.angle)*this.value,e=Math.sin(this.angle)*this.value;return new h(t,e)}scale(t){return new d(this.value*t,this.angle)}}class u{constructor(t){let{d:e,...n}=void 0===t?{}:t;i(this,"attrs",void 0),i(this,"commands",void 0),this.attrs=n,this.commands=[],e&&this.parseCommandString(e)}scale(t){return this.commands=this.commands.map((e=>e.scale(t))),this.attrs.strokeWidth=String(t*+(this.attrs.strokeWidth||0)),this}addCommand(t){return Array.isArray(t)?this.commands.push(...t):this.commands.push(t),this}getCommandString(){return 0===this.commands.length?"":this.commands.map(((t,e)=>t.toString())).join(" ").trim()}parseCommandString(t){this.commands=[];let e=null,n=[];const i=t.split(" "),s=t=>Object.values(l).includes(t)?t:null;for(let r=0;r<i.length;r+=1){const t=s(i[r]);if(t){if(!e){e=t;continue}this.commands.push(new c(e,n)),e=t,n=[]}else{if(a(+i[r]))return;n.push(+i[r])}}null!==e&&this.commands.push(new c(e,n))}parsePathElement(t){for(let e=0;e<t.attributes.length;e+=1){const n=t.attributes.item(e);n&&n.value&&("d"!==n.name?this.attrs={...this.attrs,[o(n.name)]:n.value}:this.parseCommandString(n.value))}return this}toJson(){return{...this.attrs,d:this.getCommandString()}}clone(){const t=new u(this.attrs);return this.commands.map((e=>{t.commands.push(e.clone())})),t}}class p{constructor(t){let{width:e,height:n,background:s}=t;i(this,"paths",void 0),i(this,"width",void 0),i(this,"height",void 0),i(this,"background",void 0),this.paths=[],this.width=e,this.height=n,this.background=s}resize(t){let{width:e,height:n}=t;this.scalePath(e/this.width),this.width=e,this.height=n}scalePath(t){if(1!==t)for(let e=0;e<this.paths.length;e+=1)this.paths[e].scale(t);return this}addPath(t){return Array.isArray(t)?this.paths.push(...t):this.paths.push(t),this}clonePaths(){return this.paths.map((t=>t.clone()))}updatePath(t,e){const n=e||this.paths.length-1;return n<0&&this.paths.push(t),this.paths[n]=t,this}toJson(){return{width:this.width,height:this.height,background:this.background,paths:this.paths.map((t=>t.toJson()))}}copy(t){return this.paths=t.clonePaths(),t.width&&this.width&&this.scalePath(this.width/t.width),this}parseSVGString(t){const e=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");return e?this.parseSVGElement(e):(this.paths=[],this)}parseSVGElement(t){const e=[];t.querySelectorAll("path").forEach((t=>{const n=(new u).parsePathElement(t);0!==n.commands.length&&e.push(n)})),this.paths=e;const n=Number(t.getAttribute("width"));return n&&this.width&&this.scalePath(this.width/n),this}}class g{constructor(t){let{ratio:e}=void 0===t?{}:t;i(this,"ratio",void 0),this.ratio=e??.2}_controlPoint(t,e,n){const i=new h(t.x,t.y),s=new h(e.x,e.y),r=new h(n.x,n.y).sub(i).toVector().scale(this.ratio).toPoint(),o=s.add(r);return[o.x,o.y]}bezierCurve(t,e,n,i){const s=[...this._controlPoint(t,e,n),...this._controlPoint(i,n,e),n.x,n.y];return new c(l.CURVE,s)}lineCommands(t){return t.map(((t,e)=>new c(0===e?l.MOVE:l.LINE,[t.x,t.y])))}bezierCurveCommands(t){const e=[];if(t.length<3)return this.lineCommands(t);for(let n=0;n<t.length;n+=1)0!==n?e.push(this.bezierCurve(t[n-2<0?0:n-2],t[n-1],t[n],n<t.length-1?t[n+1]:t[n])):e.push(new c(l.MOVE,[t[n].x,t[n].y]));return e}}const m="http://www.w3.org/2000/svg",v=(t,e)=>{const n=document.createElementNS(m,"svg");return n.setAttributeNS(null,"version","1.1"),n.setAttribute("xmlns",m),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Object.keys(t).sort().map((e=>{n.setAttribute(e,t[e])})),e.map((t=>{n.appendChild(t)})),n},f=(t,e)=>{const n=document.createElementNS(m,t);return Object.keys(e).sort().map((t=>{n.setAttribute(t,e[t])})),n},w=t=>{const e=Object.entries(t).reduce(((t,e,n)=>{let[i,r]=e;return r?{...t,[s(i)]:r}:t}),{});return f("path",e)},x=t=>{let{width:e,height:n,background:i,paths:s}=t;const r={width:String(e),height:String(n)},o=i?[f("rect",{...r,fill:i})]:[];return v(r,[...o,...s.map(w)])};class b{constructor(t,e){let{background:n}=void 0===e?{}:e;this.el=t;const{width:i,height:s}=t.getBoundingClientRect();t.appendChild(x({background:n,width:i,height:s,paths:[]}))}update(t){this.el.replaceChild(x(t),this.el.childNodes[0])}}const _=t=>"data:image/svg+xml;base64,"+btoa(t),y={png:"image/png",jpg:"image/jpeg",svg:"image/svg+xml"},E=t=>{let{data:e,extension:n,filename:i}=t;const s=atob(e.replace(/^.*,/,"")),r=new Uint8Array(s.length);for(let h=0;h<s.length;h+=1)r[h]=s.charCodeAt(h);const o=i||`${Date.now()}.${n}`,a=new Blob([r.buffer],{type:y[n]});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,o);else if(window.URL&&window.URL.createObjectURL){const t=document.createElement("a");t.download=o,t.href=window.URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)}else window.open(e,"_blank")},C={extension:"svg"},j=function(t,e,n){void 0===e&&(e=C),void 0===n&&(n=E);const{filename:i,extension:s}={...C,...e},r=(t=>_(x(t).outerHTML))(t.toJson());if("svg"===s)return void n({data:r,extension:"svg",filename:i});const{width:o,height:a,background:h}=t,l=new Image;l.addEventListener("load",(()=>{const t=document.createElement("canvas");t.setAttribute("width",String(o)),t.setAttribute("height",String(a));const e=t.getContext("2d");e&&((h||"jpg"===s)&&(e.fillStyle=h||"#fff",e.fillRect(0,0,o,a)),e.drawImage(l,0,0),n("png"===s?{data:t.toDataURL("image/png"),extension:"png"}:{data:t.toDataURL("image/jpeg"),extension:"jpg"}))}),!1),l.src=r},P={pointer:{start:["pointerdown"],move:["pointermove"],end:["pointerleave","pointercancel"],frameout:["pointerup"]},touch:{start:["touchstart"],move:["touchmove"],end:["touchend"],frameout:["touchcancel"]},mouse:{start:["mousedown"],move:["mousemove"],end:["mouseleave","mouseout"],frameout:["mouseup"]}};class L{constructor(t,e){let{end:n,start:s,move:r}=e;this._el=t,i(this,"_clearEventList",void 0),i(this,"_listenerOption",void 0),i(this,"_left",void 0),i(this,"_top",void 0),i(this,"end",void 0),i(this,"start",void 0),i(this,"move",void 0),this.end=n,this.start=s,this.move=r,this._clearEventList=[],this._listenerOption=function(t){void 0===t&&(t=!0);try{const e=()=>null;return addEventListener("testPassive",e,{passive:t}),removeEventListener("testPassive",e),{passive:t}}catch(t){return!1}}(!1);const{left:o,top:a}=t.getBoundingClientRect();this._left=o,this._top=a,this._handleStart=this._handleStart.bind(this),this._handleMove=this._handleMove.bind(this),this._handleEnd=this._handleEnd.bind(this)}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._setupCoordinatesListener(),window.PointerEvent?this._setupDrawListener("pointer"):this._setupDrawListener("mouse"),"ontouchstart"in window&&this._setupDrawListener("touch")}_handleStart(t){t.preventDefault(),this.start()}_handleEnd(t){t.preventDefault(),this.end()}_handleMove(t){if(t.preventDefault(),t instanceof TouchEvent){const e=t.touches[0];this.move({x:e.clientX-this._left,y:e.clientY-this._top,pressure:e.force})}else t instanceof PointerEvent?this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:t.pressure}):t instanceof MouseEvent&&this.move({x:t.clientX-this._left,y:t.clientY-this._top,pressure:null==t?void 0:t.pressure})}_setupDrawListener(t){const{start:e,move:n,end:i,frameout:s}=P[t],r=e.map((t=>(this._el.addEventListener(t,this._handleStart,this._listenerOption),()=>this._el.removeEventListener(t,this._handleStart)))),o=n.map((t=>(this._el.addEventListener(t,this._handleMove,this._listenerOption),()=>this._el.removeEventListener(t,this._handleMove)))),a=i.map((t=>(this._el.addEventListener(t,this._handleEnd,this._listenerOption),()=>this._el.removeEventListener(t,this._handleEnd)))),h=s.map((t=>(addEventListener(t,this._handleEnd,this._listenerOption),()=>removeEventListener(t,this._handleEnd))));this._clearEventList.push(...r,...o,...a,...h)}_setupCoordinatesListener(){const t=t=>{const{left:e,top:n}=this._el.getBoundingClientRect();this._left=e,this._top=n};addEventListener("scroll",t),this._el.addEventListener("resize",t),this._clearEventList.push((()=>{removeEventListener("scroll",t),this._el.removeEventListener("resize",t)}))}}class k{constructor(t,e){let{resize:n}=e;this._el=t,i(this,"_clearEventList",void 0),i(this,"resize",void 0),this.resize=n,this._clearEventList=[]}off(){this._clearEventList.map((t=>t())),this._clearEventList=[]}on(){this.off(),this._setupListerner()}_setupListerner(){if(window.ResizeObserver){const t=new window.ResizeObserver((t=>{let[e]=t;this.resize(e.contentRect)}));t.observe(this._el),this._clearEventList.push((()=>t.disconnect()))}else{const t=()=>{this.resize(this._el.getBoundingClientRect())};addEventListener("resize",t),this._clearEventList.push((()=>removeEventListener("resize",t)))}}}function S(t,e,n){let i,s,r;void 0===n&&(n={});let o=null,a=0;const h=()=>{a=!1===n.leading?0:Date.now(),o=null,r=t.apply(i,s),o||(i=null,s=null)},l=()=>{o&&(clearTimeout(o),o=null)};return function(){const c=Date.now();a||!1!==n.leading||(a=c);const d=e-(c-a);i=this;for(var u=arguments.length,p=new Array(u),g=0;g<u;g++)p[g]=arguments[g];return s=p,d<=0||d>e?(l(),a=c,r=t.apply(i,s),o||(i=null,s=null)):o||!1===n.trailing||(o=setTimeout(h,d)),r}}class O{constructor(t,e){let{penColor:n,penWidth:s,curve:r,close:o,delay:a,fill:h,background:l}=void 0===e?{}:e;this.el=t,i(this,"penColor",void 0),i(this,"penWidth",void 0),i(this,"fill",void 0),i(this,"curve",void 0),i(this,"close",void 0),i(this,"delay",void 0),i(this,"svg",void 0),i(this,"convert",void 0),i(this,"renderer",void 0),i(this,"drawHandler",void 0),i(this,"resizeHandler",void 0),i(this,"_drawPath",void 0),i(this,"_drawPoints",void 0),i(this,"_drawMoveThrottle",void 0),this.penColor=n??"#000",this.penWidth=s??1,this.curve=r??!0,this.close=o??!1,this.delay=a??0,this.fill=h??"none";const{width:c,height:d}=t.getBoundingClientRect();this._drawPath=null,this._drawPoints=[],this.svg=new p({width:c,height:d,background:l}),this.renderer=new b(t,{background:l}),this.convert=new g,this._resize=this._resize.bind(this),this.resizeHandler=new k(t,{resize:this._resize}),this.drawStart=this.drawStart.bind(this),this.drawMove=this.drawMove.bind(this),this._drawMoveThrottle=S(this.drawMove,this.delay),this.drawEnd=this.drawEnd.bind(this),this.drawHandler=new L(t,{start:this.drawStart,move:this._drawMoveThrottle,end:this.drawEnd}),this.on()}update(){this.renderer.update(this.svg.toJson())}clear(){const t=this.svg.paths;return this.svg.paths=[],this.update(),t}undo(){const t=this.svg.paths.pop();return this.update(),t}changeDelay(t){this.delay=t,this.drawHandler.move=S(this.drawMove,this.delay),this.drawHandler.on()}on(){this.drawHandler.on(),this.resizeHandler.on()}off(){this.drawHandler.off(),this.resizeHandler.off()}drawStart(){this._drawPath||(this._drawPath=this._createDrawPath(),this.svg.addPath(this._drawPath))}drawMove(t){this._drawPath&&(this._addDrawPoint(t),(this._drawPath.attrs.strokeWidth&&+this._drawPath.attrs.strokeWidth!==this.penWidth||this._drawPath.attrs.stroke!==this.penColor)&&(this._drawPath=this._createDrawPath(),this._addDrawPoint(t),this.svg.addPath(this._drawPath)),this.update())}drawEnd(){this._drawPath=null,this.update()}_createCommand(){this._drawPath&&(this.curve?this._drawPath.commands=this.convert.bezierCurveCommands(this._drawPoints):this._drawPath.commands=this.convert.lineCommands(this._drawPoints),this.close&&this._drawPath.commands.push(new c(l.CLOSE)))}_addDrawPoint(t){this._drawPoints.push(t),this._createCommand()}_createDrawPath(){return this._resize(this.el.getBoundingClientRect()),this._drawPoints=[],new u({stroke:this.penColor,strokeWidth:String(this.penWidth),fill:this.fill,strokeLinecap:this.curve?"round":"mitter",strokeLinejoin:this.curve?"round":"square"})}_resize(t){let{width:e,height:n}=t;((t,e)=>Math.trunc(t)===Math.trunc(e))(this.svg.width,e)||(this.svg.resize({width:e,height:n}),this.update())}download(t){j(this.svg,t)}}}},function(t){t.O(0,[61,774,888,179],(function(){return e=545,t(t.s=e);var e}));var e=t.O();_N_E=e}]);